---
title: "M3-3D电容提取"
order: 3
---

### **1 问题背景**

电容提取是指芯片设计过程中，利用EDA工具对金属导体和电介质组成的静电平衡系统进行电学分析，求解该系统构成的电容矩阵的过程。寄生电容在延时预估、功耗计算、串扰分析等步骤中至关重要。随着工艺进步，互连线变得更窄更细，通孔增加，单位区域的布线密度显著增加，互连线之间的电容效应显著增加，精确又快速的大规模电容提取技术变得不可或缺。

大规模电容提取，又称模式匹配(Pattern Matching)。其常见的步骤分为两个：
1. 构建模式库（Pattern Library）：根据集成电路工艺参数，列举出各种可能出现的互连结构，再对这些成千上万的中等大小结构（称为Pattern）进行二维或三维的精确电容提取。将计算出的这些结构的电容数据收集，并进行经验公式拟合，或构造查找表。

2. 版图寄生参数提取：将互连线的建模结果与Pattern中的参数对应，调用经验公式或使用查找表插值查询，得到对应的电容值。

随着半导体工艺日趋复杂，模式匹配的精度受到挑战。在三维空间下，由于互连线的参数非常庞大，几乎不可能构建出合适的查找表以及有效的经验公式，一种通过点云的方式描述互连线几何及其所处电介质环境的方法被提了出来。通过这种点云表达的形式进行三维模式匹配的探索。

### **2 问题描述**

通过点云的形式给出芯片局部区域的导体几何与电介质环境，需要估计这样的三维电容样本其精确的电容值。

**1. 实现要求**：
   - 遵循iEDA平台的模块划分，实现一个线长预测网络模型，完成功能：对给定的输入数据集进行划分，划分为训练集和测试集，并使用Pytorch进行数据预处理和读入，然后设计网络模型（可设计为CNN模型、Transformer等），对网络模型进行训练，设计损失函数，输出回归的预测结果并评估精度。

**2. 通过点云进行电容预测的方法，通常包括以下步骤**：
 - 特征处理：结合电容任务自身的特点，对点云中的特征通道进行特定处理。
 - 选点采样：不同的点对电容计算的重要性是不一样的，合适的采样策略可以显著提高模型的精度。
 - 数据增强：由于布线的灵活性，适当的对称、平移、旋转产生更多的数据有利于模型探索更多的输入空间。
 - 网络设计：一个合理的网络设计能够考虑到电容问题的特点，充分利用点云包含的信息。


### **3 输入输出**

#### **算法输入**

- [3D电容数据集](/aieda/ibm/problem/3D_Cap_PC.md)
  - 三维电容样本概述文件、点云文件。

  - **pc_annotation.csv** - 三维电容样本概述文件  
  
    | 变量名 | 描述 |
    | --- | --- |
    | point_cloud_path | 点云路径 |
    | conductor_num | 原始三维样本中，包含的导体数量 |
    | point_num | 点云规模，点数 |
    | electrode1_point_num | 主导体产生的点云规模 |
    | electrode2_point_num | 目标环境导体产生的点云规模 |
    | cap_type | 电容类型：总电容 total 或 耦合电容coupling |
    | cap | 电容参考值，标签 |
    | v1_x | 原始样本在版图中的绝对位置x坐标 |
    | v1_y | 原始样本在版图中的绝对位置y坐标 |
    | v1_z | 原始样本在版图中的绝对位置z坐标 |
    | dx | 原始样本的x方向尺寸 |
    | dy | 原始样本的y方向尺寸 |
    | dz | 原始样本的z方向尺寸 |
    | timestamp | 点云文件的生成时间 |
    | solver_time | 通过求解器计算三维电容样本的时间 |

  - **w500l2_1_C_0_0.txt** - 点云文件例子  
    | 符号 | 描述 |
    | --- | --- |
    | $x$ | 坐标x |
    | $y$ | 坐标y |
    | $z$ | 坐标z |
    | $n_x$ | 法向量x分量 |
    | $n_y$ | 法向量y分量 |
    | $n_z$ | 法向量z分量 |
    | $\varepsilon_r$ | 点附近的电介质 |
    | class | 该点的生成源头 |
    | $\Phi$ | 选择通道 |
  - Demo：line 1 : 432.715, 171.114, 0.5879, 1, 0, 0, 4.06, 1, 0  
    - 一个点的坐标在版图中是 **(432.715, 171.114, 0.5879)**  
    - 它的生成面局部法向量是 **(1, 0, 0)**。  
    - 它附近的区域充满了相对介电常数为 **4.06** 的电介质，若是在导体内部则无电介质。  
    - 他的生成源编码为 **1**。  
    - 这个点的选择通道是 **0**，是根据非目标环境导体为依据设置的。  
    - 选择通道的细节请查阅 **基于高斯定理的点云特征**

#### **算法输出**

- 根据选择通道确定的电容矩阵中的元素，及电容值。

### **4 评估指标**
- 记每个点云样本为：$x_i$
- 误差计算公式： $Err(x_i) = | \frac{C_{pred}(x_i) - C_{ref}(x_i)}{C_{ref}(x_i)} | \times 100\%$  
- 误差在5%以内的模型精度： $P(<5\%) = \frac{1}{N} \sum_{i=1}^{N} COUNTIF(Err(x_i) < 5\%)$  
- 误差在5%~10%的模型精度： $P(5\% \sim 10\%)$  
- 误差在大于等于10%的模型精度： $P(>= 10\%)$  
- 误差的平均值： $Err_{avg} = \frac{1}{N} \sum_{i=1}^{N} Err(x_i)$  
- 误差的最大值： $Err_{max}$  
- 误差的标准差： $Std$